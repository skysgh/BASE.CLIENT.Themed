<div class="dynamic-form" [class.dynamic-form--readonly]="mode === 'detail'">
  <!-- Form Header -->
  @if (showHeaderInput && (title() || description())) {
    <div class="dynamic-form__header mb-3">
      @if (title()) {
        <h5 class="dynamic-form__title">{{ title() }}</h5>
      }
      @if (description()) {
        <p class="dynamic-form__description text-muted">{{ description() }}</p>
      }
    </div>
  }

  <!-- Loading State -->
  @if (isLoading()) {
    <div class="dynamic-form__loading d-flex justify-content-center py-4">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
  }

  <!-- Error State -->
  @if (error()) {
    <div class="alert alert-danger" role="alert">
      <i class="ri-error-warning-line me-2"></i>
      {{ error() }}
    </div>
  }

  <!-- Form -->
  @if (!isLoading() && !error() && formlyFields().length > 0) {
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <formly-form
        [form]="form"
        [fields]="formlyFields()"
        [model]="formModel"
        [options]="formlyOptions">
      </formly-form>

      <!-- Form Actions -->
      @if (showActions && mode !== 'detail') {
        <div class="dynamic-form__actions mt-4 d-flex gap-2">
          @if (showSubmit) {
            <button
              type="submit"
              class="btn btn-primary"
              [disabled]="!form.valid || isSubmitting()">
              @if (isSubmitting()) {
                <span class="spinner-border spinner-border-sm me-2" role="status"></span>
              }
              {{ submitLabel }}
            </button>
          }
          @if (showCancel) {
            <button
              type="button"
              class="btn btn-outline-secondary"
              (click)="onCancel()"
              [disabled]="isSubmitting()">
              {{ cancelLabel }}
            </button>
          }
          @if (showReset) {
            <button
              type="button"
              class="btn btn-outline-secondary"
              (click)="onReset()"
              [disabled]="isSubmitting()">
              Reset
            </button>
          }
        </div>
      }
    </form>
  }

  <!-- Empty State -->
  @if (!isLoading() && !error() && formlyFields().length === 0) {
    <div class="alert alert-info" role="alert">
      <i class="ri-information-line me-2"></i>
      No form fields defined for this entity.
    </div>
  }
</div>
