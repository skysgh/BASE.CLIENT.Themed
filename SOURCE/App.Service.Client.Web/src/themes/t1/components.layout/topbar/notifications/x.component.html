<div ngbDropdown [autoClose]="'outside'" class="dropdown topbar-head-dropdown ms-1 header-item">
  <button type="button"
          ngbDropdownToggle
          class="btn btn-icon btn-topbar btn-ghost-secondary rounded-circle"
          id="page-header-notifications-dropdown"
          data-bs-toggle="dropdown"
          aria-haspopup="true"
          aria-expanded="false">
    <i class='bx bx-bell fs-22'></i>
    <!-- ✅ UPDATED: Use signal for badge count -->
    <span class="position-absolute topbar-badge fs-10 translate-middle badge rounded-pill bg-danger">
      {{ notificationService.unreadCount() }}
      <span class="visually-hidden">
        {{'BASE.NOTIFICATIONS.UNREAD' | baseTranslate }}
      </span>
    </span>
  </button>
  <div ngbDropdownMenu
       class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0"
       aria-labelledby="page-header-notifications-dropdown">
    <div class="dropdown-head bg-primary bg-pattern rounded-top">
      <div class="p-3">
        <div class="row align-items-center">
          <div class="col">
            <h6 class="m-0 fs-16 fw-semibold text-white">
              {{'BASE.NOTIFICATIONS.PLURAL' | baseTranslate }}
            </h6>
          </div>
          <div class="col-auto dropdown-tabs">
            <!-- ✅ UPDATED: Use signal -->
            <span class="badge bg-light-subtle text-body fs-13">
              {{ notificationService.unreadCount() }}
              {{'BASE.STATUS.NEW' | baseTranslate }}
            </span>
          </div>
        </div>
      </div>

      <div class="px-2 pt-2">
        <ul ngbNav #nav="ngbNav"
            [activeId]="1"
            class="nav nav-tabs dropdown-tabs nav-tabs-custom"
            id="notificationItemsTab">
          <li [ngbNavItem]="1">
            <a ngbNavLink>
              {{'BASE.QUANTITIES.ALL' | baseTranslate }}
              ({{ notificationService.enabledNotifications().length }})

            </a>
            <ng-template ngbNavContent>
              <div class="tab-pane fade show active py-2 ps-2"
                   id="all-noti-tab"
                   role="tabpanel">
                <ngx-simplebar style="max-height: 300px;">
                  <div class="pe-2">
                    <!-- ✅ UPDATED: Use signal with @for -->
                    @for(item of notificationService.enabledNotifications(); track item.id){
                    <div class="text-reset notification-item d-block dropdown-item position-relative">
                      <div class="d-flex">
                        @if(item.imageName){
                        <img [src]="getAvatarUrl(item.imageName) | async"
                             class="me-3 rounded-circle avatar-xs"
                             alt="user-pic">
                        <div class="flex-grow-1">
                          <a href="javascript:void(0);" class="stretched-link">
                            <h6 class="mt-0 mb-1 fs-13 fw-semibold">{{item.title}}</h6>
                          </a>
                          <div class="fs-13 text-muted">
                            <p class="mb-1">{{item.description}}</p>
                          </div>
                          <p class="mb-0 fs-11 fw-medium text-uppercase text-muted">
                            <span><i class="mdi mdi-clock-outline"></i> {{ item.sentUtc | date:'short' }}</span>
                          </p>
                        </div>
                        }@else{
                        <div class="avatar-xs me-3">
                          <span class="avatar-title bg-info-subtle text-info rounded-circle fs-16">
                            <i class="bx {{item.imageId}}"></i>
                          </span>
                        </div>
                        <div class="flex-grow-1">
                          <a href="javascript:void(0);" class="stretched-link">
                            <h6 class="mt-0 mb-2 lh-base">
                              {{item.description}}
                            </h6>
                          </a>
                          <p class="mb-0 fs-11 fw-medium text-uppercase text-muted">
                            <span><i class="mdi mdi-clock-outline"></i> {{ item.sentUtc | date:'short' }}</span>
                          </p>
                        </div>}
                      </div>
                    </div>
                    }
                    
                    <!-- Empty state -->
                    @if(notificationService.enabledNotifications().length === 0){
                    <div class="tab-pane p-4">
                      <div class="w-25 w-sm-50 pt-3 mx-auto">
                        <img src="{{this.appsConfiguration.others.themes.current.constants.assets.images.uncertain}}bell.svg"
                             class="img-fluid"
                             alt="no-notifications">
                      </div>
                      <div class="text-center pb-5 mt-2">
                        <h6 class="fs-18 fw-semibold lh-base">
                          {{ 'BASE.NOTIFICATIONS.NO_NEW' | baseTranslate}}
                        </h6>
                      </div>
                    </div>
                    }@else{
                    <div class="my-3 text-center">
                      <button type="button"
                              class="btn btn-soft-success waves-effect waves-light">
                        {{'BASE.ACTIONS.VIEW_ALL' | baseTranslate }}
                        <i class="ri-arrow-right-line align-middle"></i>
                      </button>
                    </div>
                    }
                  </div>
                </ngx-simplebar>
              </div>
            </ng-template>
          </li>
          
          <li [ngbNavItem]="2">
            <a ngbNavLink>
              <span>{{ 'BASE.MESSAGES.PLURAL' | baseTranslate}}</span>
            </a>
            <ng-template ngbNavContent>
              <div class="tab-pane fade show active py-2 ps-2">
                <div class="text-center p-4">
                  <p class="text-muted">Messages coming soon...</p>
                </div>
              </div>
            </ng-template>
          </li>
          
          <li [ngbNavItem]="3">
            <a ngbNavLink>{{ 'BASE.ALERTS.PLURAL' | baseTranslate}}</a>
            <ng-template ngbNavContent>
              <div class="tab-pane p-4">
                <div class="text-center">
                  <p class="text-muted">Alerts coming soon...</p>
                </div>
              </div>
            </ng-template>
          </li>
        </ul>
      </div>
    </div>

    <div class="tab-content" id="notificationItemsTabContent">
      <div class="tab-content text-muted">
        <div [ngbNavOutlet]="nav"></div>
      </div>
    </div>
  </div>
</div>
