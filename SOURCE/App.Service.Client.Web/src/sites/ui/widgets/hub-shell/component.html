<div class="hub-shell">
  <!-- Standard Page Header with back button -->
  <app-page-header 
    [title]="title"
    [icon]="icon"
    [iconBackground]="iconBackground"
    [iconClass]="iconClass"
    [showBack]="showBack"
    [showBreadcrumb]="showBreadcrumbs">
    <ng-container subtitle>
      @if (subtitle) {
        {{ subtitle }}
      } @else {
        <ng-content select="[subtitle]"></ng-content>
      }
    </ng-container>
    <ng-container actions>
      <!-- Config Button in header actions -->
      @if (showConfig) {
        <button class="btn btn-outline-secondary btn-sm" 
                (click)="openConfigPanel()"
                title="Configure hub tiles">
          <i class="bx bx-cog"></i>
        </button>
      }
    </ng-container>
  </app-page-header>

  <!-- Tile Grid - supports both default and custom tile components -->
  @if (visibleTiles().length > 0) {
    <div class="row g-4">
      @for (tile of visibleTiles(); track tile.id) {
        <div [class]="tileColumnClass">
          @if (hasCustomComponent(tile)) {
            <!-- Custom component rendering with injected tile data -->
            <ng-container 
              *ngComponentOutlet="getCustomComponent(tile); injector: getTileInjector(tile)">
            </ng-container>
          } @else {
            <!-- Default HubTile rendering -->
            <app-hub-tile [tile]="tile"></app-hub-tile>
          }
        </div>
      }
    </div>
  } @else if (!hasContent) {
    <!-- Content projection for fully custom rendering -->
    <ng-content></ng-content>
  }

  <!-- Empty state -->
  @if (visibleTiles().length === 0 && workingTiles().length > 0) {
    <div class="alert alert-info text-center mt-4">
      <i class="bx bx-eye-off me-2"></i>
      All tiles are hidden. Click the gear icon to show tiles.
    </div>
  } @else if (workingTiles().length === 0 && !hasContent) {
    <div class="alert alert-info text-center mt-4">
      <i class="bx bx-info-circle me-2"></i>
      No tiles configured for this hub.
    </div>
  }
</div>

<!-- Config Panel (Offcanvas) -->
<ng-template #configPanel let-offcanvas>
  <div class="offcanvas-header border-bottom">
    <h5 class="offcanvas-title">
      <i class="bx bx-slider me-2"></i>
      Configure {{ title }}
    </h5>
    <button type="button" class="btn-close" aria-label="Close" (click)="offcanvas.dismiss()"></button>
  </div>
  <div class="offcanvas-body p-0">
    <app-hub-shell-config-panel
      [tiles]="workingTiles()"
      [title]="'Tile Settings'"
      [subtitle]="'Drag to reorder. Toggle visibility for each tile.'"
      (tilesChange)="onConfigTilesChange($event)"
      (save)="onConfigSave($event)"
      (cancel)="onConfigCancel()"
      (reset)="onConfigReset()">
    </app-hub-shell-config-panel>
  </div>
</ng-template>
