name: Deploy to Environment

# Triggers, on specific branches
on:
  push:
    branches:
      - main
      - release
      - develop

# Running on one runner:      
jobs:
  deploy:
    runs-on: ubuntu-latest
    env:
      # BRANCH INFO
      BRANCH: ${{ github.ref }}
      BRANCH_ID: '000'
      # ENVIRONMANT INFO: it's either BT, DT, ST, UT, IT, TR, PP, PR
      ENVIRONMENT_NAME: 'Build Test'
      ENVIRONMENT_ID: 'BT' # Default to 'BT' 
      # DEFINE REPO CONSTANTS
      GITHUB_REPO_NAME_LIB: 'skysgh/resources.deployments.lib'
      GITHUB_REPO_NAME_SRC: 'skysgh/thisrepo'
      # AZURE INFO:
      AZURE_CREDENTIAL_SECRET: ${{ secrets.AZURE_CLIENT_SECRET }}
      AZURE_LOCATION_1: 'centralaustralia'
      AZURE_LOCATION_2: 'southeastasia'
      AZURE_LOCATION_3: 'global'
    steps:

      # Checkout code from *lib* repo
      # to a directory parallel to this repo's code
      - name: Checkout Library
        uses: actions/checkout@v2
        with:
          repository: GITHUB_LIB_REPO_NAME
          path: '../DeploymentLib'

      # Checkout code from *this* repo
      # without giving directory, so default:
      - name: Checkout code
        uses: actions/checkout@v2
        with:
          repository: GITHUB_REPO_NAME_SRC
  
      - name: Determine Deployment Environment
        run: |
          if [[ ${{ github.ref }} == 'refs/heads/main' ]]; then
            export ENVIRONMENT_NAME='Dev Test'
            export ENVIRONMENT_ID='DT'
          elif [[ ${{ github.ref }} == 'refs/heads/release' ]]; then
            echo "Setting deployment environment to production."
            export ENVIRONMENT_NAME='Production'
            export ENVIRONMENT_ID='PR'
          echo "Setting deployment environment to staging."
            export DEPLOYMENT_ENV='staging'
          else
            export ENVIRONMENT_NAME='Build Test'
            export ENVIRONMENT_ID='BT'
          fi

      - name: Setup Variables
        run: |
  

      - name: Login to Azure
        run: |

      - name: Ensure Resource Group(s)
        run: |
          # Your deployment commands here

      - name: Ensure Static WebSite Resource
        run: |
          # Your deployment commands here

      - name: Compile source code
        run: |

      - name: Take offline
        run: |

      - name: Deploy source code
        run: |

      - name: Wake
        run: |

      - name: Bring back online
        run: |
